<!DOCTYPE html>
<html>
  <head>
    <title>Signup</title>
    <link rel="stylesheet" href="signup.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet"
/>
    <script type="module">
      import {
        ref,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
      import { db } from "./firebaseConfig.js";

      const signup = async (username, email, password) => {
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, `users/`));

        if (snapshot.exists()) {
          const users = snapshot.val();
          for (let key in users) {
            if (users[key].username === username) {
              alert("Username already exists");
              return;
            }
            if (users[key].email === email) {
              alert("Email already exists");
              return;
            }
          }
        }

        const userId = Date.now(); // Unique ID for the user
        set(ref(db, "users/" + userId), {
          username,
          email,
          password,
          online: false,
        })
          .then(() => {
            alert("Signup successful");
            window.location.href =
              "lobby.html?username=" + encodeURIComponent(username); // Redirect to lobby
          })
          .catch((error) => {
            console.error(error);
          });
      };

      document.getElementById("signup-button").addEventListener("click", (event) => {
        event.preventDefault()
        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        signup(username, email, password);
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1 class="mainTitle">Rock, Paper & Sicssors</h1>
      <img src="2.png" alt="" class="bg-login">
      <form action="" class="formContainer">
        <h2 class="title">Signup</h2>
            <div class="input-container">
              <i class="ri-user-fill"></i>
              <input class="uname" type="text" id="username" placeholder="Username" required />
            </div>
        <div class="input-container email-container">
         
            <i class="ri-mail-add-fill"></i> 
            <!-- <i class="ri-mail-check-fill"></i> -->
            <!-- <i class="ri-mail-close-fill"></i> -->
         
          <input class="email-input" type="email" id="email" placeholder="Email" required />
        </div>
        <div class="input-container password-container ">
          <!-- <i class="ri-key-fill"></i>
          <i class="ri-eye-fill"></i> -->
          <i class="ri-eye-close-fill"></i>
          <input class="password-input" type="password" id="password" placeholder="Password" required />
        </div>
        <button id="signup-button" class="signupbtn">Signup</button>
      </form>
    </div>
  </body>
</html>
